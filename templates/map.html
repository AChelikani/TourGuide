<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="{{ url_for('static',filename='favicon.png') }}">
    <link rel='stylesheet' media='screen and (min-width: 1700px)' href='../static/css/styles.css' />
    <link rel='stylesheet' media='screen and (max-width: 1699px)' href='../static/css/smallscreen.css' />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>NextStop</title>
    <meta name="generator" content="Bootply" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="{{ url_for('static',filename='css/bootstrap.min.css') }}" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="http://js.api.here.com/v3/3.0/mapsjs-ui.css" />

  </head>
  <body>
<!-- begin template -->
<div class="inputbar">
  <img src="../static/logo.png" id="logo" />
  <form id="formRoute" class="form-inline" role="form">
    <div class="form-group">
      <input type="text" class="form-control" name="fromtime" id="start" placeholder="Start Time">
    </div>
    <div class="form-group">
      <input type="text" class="form-control" name="totime" id="end" placeholder = "End Time">
    </div>
    <div class="form-group">
      <input type="text" class="form-control" name="from" id="from" placeholder = "Starting Location...">
    </div>
    <div class="form-group">
      <input type="text" class="form-control" name="to" id="to" placeholder = "Ending Location...">
    </div>
    <button class="btn btn-sml" id="btnGen">Generate!</button>
  </form>
</div>

<div class="container-fluid" id="main" style="visibility:hidden;">
  <div class="row">
    <div class="col-xs-5 center-block" id="left">

      <h2><center>Venues</center></h2>
        <ul class="list-group" id="activityList">
        </ul>
    </div>

    <div class="col-xs-1 center-block"></div>

    <div class="col-xs-5 center-block"><div id="map-canvas" style="height:600px; width:725px;"></div>
  </div>

  </div>
</div>


<!-- end template -->

  <!-- script references -->
    <script src="http://js.api.here.com/v3/3.0/mapsjs-core.js" type="text/javascript" charset="utf-8"></script>
    <script src="http://js.api.here.com/v3/3.0/mapsjs-service.js" type="text/javascript" charset="utf-8"></script>
    <script src="http://js.api.here.com/v3/3.0/mapsjs-ui.js" type="text/javascript" charset="utf-8"></script>
    <script src="http://js.api.here.com/v3/3.0/mapsjs-mapevents.js" type="text/javascript" charset="utf-8"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="{{ url_for('static',filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/scripts.js') }}"></script>

    <script type="text/javascript">

      var url = "http://localhost:5000/pathfind?from=Berkeley&to=Caltech&fromtime=Oct10&totime=Oct12";
      var locations = [];
      var names = [];
      var itinerary = [];

      $.getJSON(url, function(data) {
        for(i = 0; i < data.activityList.length; i ++) {
          names.push(data.activityList[i].activity);
          var temp = [data.activityList[i].latitude, data.activityList[i].longitude];
          locations.push(temp);
        }
        localStorage.setItem("itinerary", data.itinerary);
        localStorage.setItem("locations", locations);
        localStorage.setItem("names", names);
      });

      var platform = new H.service.Platform({
        'app_id': 'N6MJW6UzW079S5ZZwcPl',
        'app_code': 'FOkZLbFrMx77dDpomCs9ZQ'
      });

      var defaultLayers = platform.createDefaultLayers();
      var map;
      var ui;
      var mapEvents;
      var behavior;

      function initialize() {
        locations = localStorage.getItem("locations").split(",");
        names = localStorage.getItem("names").split(",");
        itinerary = localStorage.getItem("itinerary").split(",");

        map = new H.Map(
            document.getElementById('map-canvas'),
            defaultLayers.normal.map,
            {
              zoom: 10,
              center: { lat: 34.13, lng: -118.12 }
            });

        ui = H.ui.UI.createDefault(map, defaultLayers);

        mapEvents = new H.mapevents.MapEvents(map);
        behavior = new H.mapevents.Behavior(mapEvents);

        for(i = 0; i < itinerary.length; i ++) {
          if (itinerary[i].indexOf("Uber") == -1) {
            var temp = itinerary[i];
            var pos = names.indexOf(temp);
            console.log(temp);
            var latlong = [parseFloat(locations[pos*2]), parseFloat(locations[pos*2+1])];
            var marker = new H.map.Marker({ lat: latlong[0], lng: latlong[1] });
            map.addObject(marker);
          }
        }

      }


      window.addEventListener('load', initialize, false )
    </script>

  </body>
</html>
